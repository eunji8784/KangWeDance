<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.kang.parents.model.mapper.ParentsMapper">
	<resultMap id="parent" type="ParentsDto">
		<result column="parent_idx" property="parentIdx" />
		<result column="social_platform" property="socialPlatform" />
		<result column="socail_uid" property="socailUid" />
		<result column="nickname" property="nickname" />
		<result column="experience_score" property="experienceScore" />
		<result column="deleted_flag" property="deletedFlag" />
	</resultMap>
	<select id="selectExperience" parameterType="int" resultType="int">
		select experience_score
		from parent
		where parent_idx = #{idx}
	</select>
	<select id="selectChildren" parameterType="int" resultType="int">
		select count(*)
		from children
		where parent_idx = #{idx}
	</select>
	<update id="updateNickname" parameterType="ParentsDto">
		update parent
		set nickname = #{nickname}
		where parent_idx =#{parentIdx}
	</update>
	<delete id="deleteUser" parameterType="int">
		delete from parent
		where parent_idx = #{idx}
	</delete>
	<select id="selectSocial" parameterType="String" resultMap="parent">
		select * 
		from parent 
		where socail_uid = #{socailUid}
	</select>
	<insert id="insertUser" parameterType="ParentsDto" useGeneratedKeys="true" keyColumn="parent_idx" keyProperty="parentIdx">
		insert into parent(social_platform,socail_uid,nickname,access_token)
		value(#{socialPlatform},#{socailUid},#{nickname},#{accessToken})
	</insert>
	<update id="updateUser" parameterType="ParentsDto">
		update parent
		set deleted_flag = 0, nickname = #{nickname}
		where parent_idx = #{parentIdx}
	</update>
</mapper>
